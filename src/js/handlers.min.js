/*! 注释信息 */define(["util","data"],function(a,b){function c(a,b,c,d,e){this.data=a,this.text=b,this.amount=c,this.childNode=[],this.FatherNode=e}function d(){v=e(b.treedata),h(v,a.$("root")),console.log(v)}function e(a){function b(a){for(var d in a){var g=f(a[d]);console.log(g,d,a[d]);var h=new c(null,d,g,null,null);"任务列表"===d&&(e=h),"使用说明"===d&&(w=h),A.push(h),"object"==typeof a[d]&&b(a[d])}}function d(){if(0!==A.length)for(var a=A[0],b=0;b<a.amount;b++)a.childNode.push(A[1]),A[1].FatherNode=a,A.shift(),d()}var e;return console.log(a.length),b(a),d(),e}function f(a){num=0;for(var b in a)num++;return num}function g(a,c){var d=document.createElement("div"),e=document.createElement("span"),f=document.createElement("div"),g=document.createElement("div"),h=document.createElement("i"),i=document.createElement("i"),j=document.createElement("i"),k=document.createElement("i");return 0===c?(h.setAttribute("class","fa fa-file-text-o tree-title-sign"),h.style.display="inline-block",e.innerHTML=a,e.setAttribute("class","tree-title tree-title-task"),i.setAttribute("class","fa fa-trash-o tree-delet"),d.setAttribute("class","child"),d.style.display="block",d.value=a,f.setAttribute("class","i-collect"),d.appendChild(h),g.setAttribute("class","tree-title-box"),g.appendChild(e),g.appendChild(f),d.appendChild(g)):(h.setAttribute("class","fa fa-folder-open-o tree-title-sign"),h.style.display="inline-block",e.innerHTML=a,e.setAttribute("class","tree-title tree-title-classify"),k.setAttribute("class","fa fa-plus-circle task-add"),j.setAttribute("class","fa fa-folder-o tree-add"),i.setAttribute("class","fa fa-trash-o tree-delet"),d.setAttribute("class","child"),d.style.display="block",d.value=a,d.setAttribute("id",b.fatherIdArr[b.fatherIdnum++]),f.setAttribute("class","i-collect"),"任务列表"==a&&f.setAttribute("id","root-title"),f.appendChild(k),f.appendChild(j),f.appendChild(i),d.appendChild(h),g.setAttribute("class","tree-title-box"),g.appendChild(e),g.appendChild(f),d.appendChild(g)),d}function h(a,b){if(null!==a){value=a.text;var c=g(value);a.data=c,b.appendChild(c)}a.childNode.length>=0&&(a.data.firstChild.style.display="inline-block");for(var d=0;d<a.childNode.length;d++)h(a.childNode[d],c)}function i(){function a(a){for(;a.length>0;)a.shift().firstChild.nextSibling.id=""}B=[],a(C)}function j(a,b,c){function d(a){if(a.data!==i){if(null!==a)for(var b=0;b<a.childNode.length;b++)d(a.childNode[b])}else{if(!a.FatherNode)return;a.FatherNode.data.firstChild.className="fa fa-folder-open-o tree-title-sign";for(var c=0;c<a.FatherNode.childNode.length;c++)a.FatherNode.childNode[c].data.style.display="block";for(var e=a.FatherNode;null!==e.FatherNode;){for(e.FatherNode.data.firstChild.className="fa fa-folder-open-o tree-title-sign",c=0;c<e.FatherNode.childNode.length;c++)e.FatherNode.childNode[c].data.style.display="block";e=e.FatherNode}}}var e=0,f=[];for(console.log(typeof b);a.length>0;){var g=a.shift();if(C.push(g),f.length>0)for(var h=0;h<f.length;h++){var i=f[h];d(c)}var j=new RegExp(b,"gi");null!==b&&j.test(g.value.toString())&&(g.firstChild.nextSibling.className="tree-title-box highlight",f.push(g),e++)}null!==b&&(0===e?I.noteText("alertText","没有查询到元素","green"):I.noteText("alertText","查询到"+e+"个元素","green"))}function k(a){if(null!==a){B.push(a.data);for(var b=0;b<a.childNode.length;b++)k(a.childNode[b])}return B}function l(){function d(a){if("fa fa-bolt tree-title-sign"===a.target.className){console.log("preOrderHHA");var b=a.target.parentNode.getElementsByClassName("child");console.log(b.length);for(var c=0;c<b.length;c++)"block"===b[c].style.display?b[c].style.display="none":b[c].style.display="block"}}function e(b){var c={"fa fa-folder-o tree-add":"popup-add-classify","fa fa-plus-circle task-add":"popup-add-task","fa fa-trash-o tree-delet":"popup-del-classify","task-list-title":"popup-task-more","fast-add-task":"popup-add-fast-task","fa fa-pencil-square-o fa-lg":"popup-add-task","fa fa-pencil-square-o fa-lg fast-change-list":"popup-add-fast-task"};if(c[b.target.className.toLowerCase()]){var d=c[b.target.className.toLowerCase()];console.log(b.target),console.log(d),o(),a.$(d).style.display="flex"}if("fa fa-pencil-square-o fa-lg"===b.target.className.toLowerCase())for(var e=0;e<F.length;e++)b.target.parentNode.parentNode===F[e].li&&(z=F[e],a.$("text").value=F[e].endTime,a.$("task-input-title").value=F[e].title,a.$("task-input-content").value=F[e].content,a.$("popup-add-task").getElementsByTagName("h1")[0].innerHTML="编辑任务");else if("fa fa-pencil-square-o fa-lg fast-change-list"===b.target.className.toLowerCase())for(var f=0;f<F.length;f++)b.target.parentNode.parentNode===F[f].li&&(z=F[f],a.$("fast-task-input-title").value=F[f].title,a.$("popup-add-fast-task").getElementsByTagName("h1")[0].innerHTML="编辑快速任务");var g=a.$("popup-add-task-content");g.parentNode.removeChild(g),a.$("popup-add-task").getElementsByTagName("section")[0].appendChild(g),g.style.display="block"}a.$.delegate(a.$("tree"),"i","click",e),a.$.delegate(a.$("task-ul-one"),"span","click",e),a.addEvent(a.$("fast-add-task-btn"),"click",e),a.addEvent(a.$("fast-task-list"),"click",d),a.$.delegate(a.$$("right-section")[0],"i","click",e),a.$.delegate(a.$("task-ul-one"),"span","click",q.taskMoreHandle),a.$.delegate(a.$$("right-section")[0],"div","click",q.taskDoneHandle),a.addEvent(a.$$("theme-color")[0],"click",function(b){"button"===b.target.nodeName.toLowerCase()&&(console.log(b.target.className),document.getElementsByTagName("body")[0].className="theme-"+b.target.className,a.$$("settings")[0].style.display="none",localStorage.setItem("color","theme-"+b.target.className))}),a.addEvent(a.$$("font-size")[0],"click",function(b){"button"===b.target.nodeName.toLowerCase()&&(console.log(b.target.className),document.getElementsByTagName("html")[0].className="theme-"+b.target.className,a.$$("settings")[0].style.display="none",localStorage.setItem("font","theme-"+b.target.className))}),a.addEvent(a.$$("fa fa-cog fa-2x")[0],"click",function(b){"i"===b.target.nodeName.toLowerCase()&&(console.log("focus"),"block"===a.$$("settings")[0].style.display?a.$$("settings")[0].style.display="none":a.$$("settings")[0].style.display="block")}),a.$("tree").addEventListener("click",function(b){function c(a){if(a.data===h.parentNode){g=a.childNode.length;for(var b=0;b<a.childNode.length;b++)"block"===a.childNode[b].data.style.display?a.childNode[b].data.style.display="none":a.childNode[b].data.style.display="block"}if(null!==a)for(var d=0;d<a.childNode.length;d++)c(a.childNode[d])}function d(b){console.log(b);var c=b.getElementsByClassName("child");if(c.length>0)for(var e=0;e<c.length;e++)d(c[e]);else for(var f=0;f<F.length;f++)if(b===F[f].cnode){a.$("task-ul-one").appendChild(F[f].li);break}}if(!b.target&&!b.srcElement||"fa fa-folder-open-o tree-title-sign"!==b.target.className&&"fa fa-folder-open tree-title-sign"!==b.target.className){if((b.target||b.srcElement)&&"tree-title tree-title-classify"===b.target.className){console.log("title click");var e=b.target.parentNode.parentNode;"任务列表"===b.target.innerHTML?a.$("task-ul-one").getElementsByTagName("span")[0].innerHTML="任务列表":a.$("task-ul-one").getElementsByTagName("span")[0].innerHTML="任务列表 > "+b.target.innerHTML;for(var f=a.$("task-ul-one").getElementsByTagName("li");f.length;)a.$("task-ul-one").removeChild(f[0]);d(e)}}else{var g,h=b.target;c(v),console.log(g),g&&("tree-title-box"===h.className&&(h=h.previousSibling),"fa fa-folder-open-o tree-title-sign"===h.className?h.className="fa fa-folder-open tree-title-sign":"fa fa-folder-open tree-title-sign"===h.className&&(h.className="fa fa-folder-open-o tree-title-sign"))}},!1),a.$("tree").addEventListener("click",function(b){(b.target||b.srcElement)&&"fa fa-trash-o tree-delet"===b.target.className&&(x=b.target.parentNode.parentNode.parentNode,x.getElementsByClassName("tree-title-task").length>0?(console.log("文件夹里还有任务未完成"),a.$("popup-del-classify").getElementsByTagName("section")[0].innerHTML="此分类里还有任务未完成<br>请先完成任务后再删除",a.$("popup-del-classify").getElementsByTagName("footer")[0].style.display="none"):(a.$("popup-del-classify").getElementsByTagName("section")[0].innerHTML="确定删除分类及分类中的全部任务",a.$("popup-del-classify").getElementsByTagName("footer")[0].style.display="block",a.$("del-classify-btn").addEventListener("click",function(){function b(a){if(a.data===x){console.log(a.text);var c=a.FatherNode.childNode.indexOf(a);console.log(c),a.FatherNode.childNode.splice(c,1);J.delClassifySto(x);return void J.treeNodeIdChange()}if(null!==a)for(var d=0;d<a.childNode.length;d++)b(a.childNode[d])}console.log("delet"),i(),b(v),x.parentNode&&x.parentNode.removeChild(x),a.$("popup-del-classify").style.display="none"},!1)))},!1),a.$("tree").addEventListener("click",function(a){var b=/tree-add|task-add/gi;(a.target||a.srcElement)&&b.test(a.target.className.toLowerCase())&&(console.log("add"),x=a.target.parentNode.parentNode.parentNode,i())},!1),a.$("addbtn").addEventListener("click",function(){function d(a){if(a.data!==x){if(null!==a)for(var b=0;b<a.childNode.length;b++)d(a.childNode[b])}else{a.childNode.push(h),h.FatherNode=a,a.data.firstChild.style.display="inline-block",a.data.firstChild.className="fa fa-folder-open-o tree-title-sign",h.data=i;for(var c=0;c<a.childNode.length;c++)a.childNode[c].data.style.display="block"}}var e;if(e=I.addcheckInputText("alertText2",a.$("addinputText")),null!==e&&""!==e){a.$("popup-add-classify").style.display="none",console.log(e);var f=J.addClassifySto(x,e),h=new c(null,e,0,null,null),i=g(e);b.fatherIdArr.pop(),b.fatherIdArr.splice(f,0,"fatherId"+b.fatherIdjsq++),J.treeNodeIdChange(f),x.appendChild(i),d(v)}},!1),a.$("add-task-btn").addEventListener("click",function(){function b(a){if(a.data!==x){if(null!==a)for(var c=0;c<a.childNode.length;c++)b(a.childNode[c])}else{a.childNode.push(i),i.FatherNode=a,a.data.firstChild.style.display="inline-block",a.data.firstChild.className="fa fa-folder-open-o tree-title-sign",i.data=j,console.log(a.data.id);var g={fatherId:a.data.id,title:d,pnode:a.data,cnode:j,content:e,endTime:f,type:"normal"},h=new q(g);h.init(h),F.push(h);var k=a.data.getElementsByClassName("tree-title")[0].innerHTML;a.data.getElementsByClassName("tree-title")[0].innerHTML=m(k,"add");for(var l=0;l<a.childNode.length;l++)a.childNode[l].data.style.display="block"}}var d=I.addcheckInputText("alertText3",a.$("task-input-title")),e=I.addcheckInputText("alertText3",a.$("task-input-content")),f=a.$("text").value;if("编辑任务"===a.$("h1Name").innerHTML){if(console.log("编辑任务"),null!==d&&""!==d){var h=F.indexOf(z);F[h].endTime=a.$("text").value,F[h].title=a.$("task-input-title").value,F[h].content=a.$("task-input-content").value,F[h].li.getElementsByClassName("task-list-title")[0].innerHTML=a.$("task-input-title").value,F[h].li.getElementsByClassName("task-list-endtime")[0].innerHTML=a.$("text").value,F[h].cnode.getElementsByClassName("tree-title")[0].innerHTML=a.$("task-input-title").value,a.$("popup-add-task").style.display="none",a.$("h1Name").innerHTML="添加任务"}}else if(null!==d&&""!==d){a.$("popup-add-task").style.display="none",console.log(d,e);var i=new c(null,d,0,null,null),j=g(d,0);x.appendChild(j),b(v)}J.TaskChange(),o()},!1),a.$("add-fast-task").addEventListener("click",function(){if("编辑快速任务"===a.$("fastH1Name").innerHTML){console.log("编辑快速任务");F.indexOf(z);z.title=a.$("fast-task-input-title").value,z.li.getElementsByClassName("task-list-title")[0].innerHTML=a.$("fast-task-input-title").value,z.cnode.getElementsByClassName("tree-title")[0].innerHTML=a.$("fast-task-input-title").value,a.$("popup-add-fast-task").style.display="none",a.$("fastH1Name").innerHTML="添加快速任务"}else{var b=I.addcheckInputText("alertText4",a.$("fast-task-input-title"));if(null!==b&&""!==b){var c=g(b,0);a.$("fast-task-list").appendChild(c);var d={fatherId:"fast-task-list",title:b,pnode:a.$("fast-task-list"),cnode:c,type:"fast"},e=new q(d);e.init(e),F.push(e),a.$("popup-add-fast-task").style.display="none";var f=a.$("fast-task-list").getElementsByClassName("tree-title")[0].innerHTML;a.$("fast-task-list").getElementsByClassName("tree-title")[0].innerHTML=m(f,"add")}}J.TaskChange(),o()},!1),a.$("preSearch").addEventListener("click",function(){console.log("click!!!!");var b=I.checkInputText("alertText",a.$("inputText"));null!==b&&""!==b?(i(),j(k(v),b,v)):I.noteText("alertText","查询不能为空","#EC9B69")},!1),a.$("inputText").addEventListener("focus",function(){console.log("focus"),I.noteText("alertText","请输入查询元素","#313F5F"),y=!0},!0),a.$("inputText").addEventListener("blur",function(b){I.checkInputText("alertText",a.$("inputText")),y=!1},!0),a.addEvent(a.$("endtime-sort"),"click",function(){console.log("endtime sort");var b=[],c=a.$("task-ul-one").getElementsByTagName("li");for(var d in c)for(var e in F)if(c[d]===F[e].li){b.push(F[e]);break}for("ascending"===a.$("endtime-sort").className?(b.sort(function(a,b){return a.endTime>=b.endTime?1:-1}),a.$("endtime-sort").className="descending"):(b.sort(function(a,b){return a.endTime<=b.endTime?1:-1}),a.$("endtime-sort").className="ascending");c.length;)a.$("task-ul-one").removeChild(c[0]);for(var f in b)console.log(b[f].endTime),a.$("task-ul-one").appendChild(b[f].li)})}function m(a,b){var c=a,d=c.split(/[(]{1}|[)]{1}/gi);return console.log(d),"sub"===b?d.length>=3&&(parseInt(d[d.length-2])-1===0?a=c.replace("<span>(1)</span>",""):(console.log("sub num"),a=c.replace(parseInt(d[d.length-2])+"",parseInt(d[d.length-2])-1+""),console.log(a))):(console.log("add num"),a=d.length>=3?c.replace(parseInt(d[d.length-2])+"",parseInt(d[d.length-2])+1+""):c+"<span>(1)</span>",console.log(d)),a}function n(a){this.btnName=a.btnName,this.idName=a.idName,this.className=a.className,this.headerName=a.headerName,this.confirmBtn=a.confirmBtn,this.textContent=a.textContent,void 0!==a.h1Name&&(this.h1Name=a.h1Name)}function o(){a.$("text").value=D,a.$("task-input-title").value="",a.$("fast-task-input-title").value="",a.$("task-input-content").value="",a.$("calendar1").style.display="none"}function p(){}function q(a){this.fatherId=a.fatherId,this.title=a.title,this.cnode=a.cnode,this.pnode=a.pnode,this.content=a.content,this.endTime=a.endTime,this.type=a.type,this.li=null}function r(b){function c(){var b=new Date,c=Math.abs(e.getTime()-b.getTime()),f=Math.floor(c/864e5),g=Math.floor(c%864e5/36e5),h=Math.floor(c%864e5%36e5/6e4),i=Math.floor(c%864e5%36e5%6e4/1e3);c<0?window.clearInterval(G):e.getTime()>b.getTime()?a.$("popup-task-more").getElementsByTagName("footer")[0].innerHTML="截止日期"+d[0]+"-"+d[1]+"-"+d[2]+"<br>还有"+f+"天"+g+"小时"+h+"分"+i+"秒":a.$("popup-task-more").getElementsByTagName("footer")[0].innerHTML="截止日期"+d[0]+"-"+d[1]+"-"+d[2]+"<br>已过去"+f+"天"+g+"小时"+h+"分"+i+"秒"}G&&window.clearInterval(G);var d=b.split("-"),e=new Date(d[0],d[1]-1,d[2],0,0,0);console.log(e),c(),G=window.setInterval(c,1e3)}function s(){}function t(){for(var b=["普通任务列表","添加任务","添加新分类","点击对勾完成任务"],d=["可以设定任务的名称、任务描述、任务截止时间","通过左侧自定义分类的加号图标添加任务","通过左侧自定义分类的文件夹图标添加新分类","点击对勾完成任务"],e=["2016-05-20","2016-06-20","2017-07-20","2018-08-20"],f=0;f<b.length;f++){var h=b[f],i=d[f],j=e[f],k=new c(null,h,0,null,null);w.amount=4,w.childNode.push(k),k.FatherNode=w;var l=g(h,0);k.data=l;var m=a.$("fatherId1");console.log(m),m.appendChild(l);var n={fatherId:"fatherId1",title:b[f],pnode:m,cnode:l,content:i,endTime:j,type:"normal"},o=new q(n);o.init(o),F.push(o)}for(var p=["快速任务列表","点击左下角的圆圈快速添加任务","可以用简短的一句话来描述任务"],r=0;r<p.length;r++){var s=p[r],t=g(s,0);a.$("fast-task-list").appendChild(t);var u={fatherId:"fast-task-list",title:s,pnode:a.$("fast-task-list"),cnode:t,type:"fast"},v=new q(u);v.init(v),F.push(v)}a.$("fatherId1").getElementsByClassName("tree-title")[0].innerHTML+="<span>(4)</span>",a.$("fast-task-list").getElementsByClassName("tree-title")[0].innerHTML+="<span>(3)</span>"}function u(){M();var a=new n(b.popupAddClassify);a.init(a);var c=new n(b.popupAddTask);c.init(c);var d=new n(b.popupDelClassify);d.init(d);var e=new n(b.popupTaskMore);e.init(e);var f=new n(b.popupFastAdd);f.init(f),l();var g=new p;g.renderCalendar(),g.init();var h=new s;h.init(),N()}var v,w,x,y,z,A=[],B=[],C=[];n.prototype.init=function(a){var b=document.createElement("div");b.setAttribute("id",a.idName),b.setAttribute("className",a.className);var c=document.createElement("div");c.setAttribute("class","popup-board");var d=document.createElement("header"),e=document.createElement("h1");void 0!==a.h1Name&&e.setAttribute("id",this.h1Name),e.innerHTML=a.headerName;var f=document.createElement("i");f.setAttribute("class","fa fa-times-circle popup-close fa-lg"),f.setAttribute("aria-hidden","true"),d.appendChild(e),d.appendChild(f);var g=document.createElement("section");g.innerHTML=a.textContent;var h=document.createElement("footer"),i=document.createElement("button");i.setAttribute("class","btn-ok"),i.setAttribute("id",a.confirmBtn),i.innerHTML="确认";var j=document.createElement("button");j.setAttribute("class","btn-canel popup-close"),j.innerHTML="取消",c.appendChild(d),c.appendChild(g),"popup-task-more"!==a.idName&&(h.appendChild(i),h.appendChild(j)),c.appendChild(h),b.appendChild(c),document.getElementsByTagName("body")[0].appendChild(b),a.AddListener.initClose(a)},n.prototype.AddListener={initClose:function(b){a.$(b.idName).addEventListener("click",function(c){var d=/popup-close/gi;(c.target||c.srcElement)&&d.test(c.target.className.toLowerCase())&&(a.$(b.idName).style.display="none")},!1),a.$(b.idName).addEventListener("click",function(c){c.target.id===b.idName&&(a.$(b.idName).style.display="none")},!1)}};var D,E=["日","一","二","三","四","五","六"];p.prototype={init:function(){var b=new Date;b=this.getYMD(b),console.log(b.year,b.month+1,b.day,E[b.weekday]),a.$("calendar-year").innerHTML=b.year,a.$("calendar-month").innerHTML=b.month+1,this.setCldYear(b.year),this.setCldMonth(b.month),this.setCldDay(b.day),b.month++,b.month<10&&(b.month="0"+b.month),b.year<10&&(b.year="0"+b.year),b.day<10&&(b.day="0"+b.day),D=b.year+"-"+b.month+"-"+b.day,this.selectDay(this),this.selectYear(this),this.selectMonth(this),this.showCld()},renderCalendar:function(){var b=document.createElement("div"),c=document.createElement("div"),d=document.createElement("span"),e=document.createElement("span"),f=document.createElement("div"),g=document.createElement("div"),h=document.createElement("span"),i=document.createElement("span"),j=document.createElement("div"),k=document.createElement("ul"),l=document.createElement("div"),m=document.createElement("div"),n=document.createElement("span"),o=document.createElement("span"),p=document.createElement("div"),q=document.createElement("ul");b.setAttribute("class","calendar"),b.setAttribute("id","calendar1"),c.setAttribute("class","calendar-select-box"),d.setAttribute("class","change-btn"),e.setAttribute("class","change-btn"),f.setAttribute("class","calendar-year-box"),g.setAttribute("class","calendar-year-btn  click-year-box"),h.setAttribute("id","calendar-year"),h.setAttribute("class","click-year-box"),i.setAttribute("class","select-btn click-year-box"),j.setAttribute("class","calendar-year-select"),k.setAttribute("id","calendar-year-select-ul");for(var r=0;r<20;r++){var s=document.createElement("li");k.appendChild(s)}j.appendChild(k),g.appendChild(h),g.appendChild(i),f.appendChild(g),f.appendChild(j),l.setAttribute("class","calendar-month-box"),m.setAttribute("class","calendar-month-btn click-month-box"),n.setAttribute("id","calendar-month"),n.setAttribute("class"," click-month-box"),o.setAttribute("class","select-btn  click-month-box"),p.setAttribute("class","calendar-month-select"),q.setAttribute("id","calendar-month-select-ul");for(var t=0;t<12;t++){var u=document.createElement("li");q.appendChild(u)}p.appendChild(q),m.appendChild(n),m.appendChild(o),l.appendChild(m),l.appendChild(p),c.appendChild(d),c.appendChild(f),c.appendChild(l),c.appendChild(e),b.appendChild(c),a.$("cal-pos").appendChild(b);for(var v=document.createElement("div"),w=document.createElement("table"),x=document.createElement("thead"),y=document.createElement("tr"),z=0;z<7;z++){var A=document.createElement("th");A.innerHTML=E[z],y.appendChild(A)}v.setAttribute("id","calendar-cells"),w.setAttribute("class","tableHead"),x.appendChild(y),w.appendChild(x),v.appendChild(w),a.$("calendar1").appendChild(v)},setText:function(b){var c=parseInt(a.$("calendar-year").innerHTML),d=parseInt(a.$("calendar-month").innerHTML);b=parseInt(b),d<10&&(d="0"+d),c<10&&(c="0"+c),b<10&&(b="0"+b),a.$("text").value=c+"-"+d+"-"+b,"none"===a.$$("calendar")[0].style.display?a.$$("calendar")[0].style.display="block":a.$$("calendar")[0].style.display="none"},getYMD:function(a){var b={};return b.year=a.getFullYear(),b.month=a.getMonth(),b.day=a.getDate(),b.weekday=a.getDay(),b},setCldYear:function(b){b=parseInt(b),a.$("calendar-year").innerHTML=b;for(var c=a.$("calendar-year").parentNode.parentNode.getElementsByClassName("calendar-year-select")[0],d=c.getElementsByTagName("li"),e=0;e<d.length;e++)d[e].style.backgroundColor="#fff",d[e].innerHTML=b+e-9;d[9].style.backgroundColor="lightgreen",this.setCldDate()},setCldMonth:function(b){b=parseInt(b);var c;b<0&&(b=11,c=parseInt(a.$("calendar-year").innerHTML),this.setCldYear(c-1)),b>11&&(b=0,c=parseInt(a.$("calendar-year").innerHTML),this.setCldYear(c+1)),a.$("calendar-month").innerHTML=b+1;for(var d=a.$("calendar-month").parentNode.parentNode.getElementsByClassName("calendar-month-select")[0],e=d.getElementsByTagName("li"),f=0;f<e.length;f++)e[f].style.backgroundColor="#fff",e[f].innerHTML=f+1;e[b].style.backgroundColor="lightgreen",this.setCldDate()},setCldDay:function(a){for(var b=document.getElementsByTagName("td"),c=0;c<b.length;c++)b[c].innerHTML===a+""&&(b[c].style.backgroundColor="lightgreen",this.setText(a))},setCldDate:function(){function b(){var b=document.createElement("table"),c=document.createElement("tbody");b.setAttribute("id","tableBody");var d,e,f=(g.weekday+h.day)%7,i=0;d=0===f?g.weekday+h.day:g.weekday+h.day+7-f,e=d/7;for(var j=0;j<e;j++){for(var k=document.createElement("tr"),l=0;l<7;l++){var m=document.createElement("td");i<g.weekday||i>=h.day+g.weekday?m.innerHTML="":m.innerHTML=i-g.weekday+1,i++,k.appendChild(m)}c.appendChild(k)}b.appendChild(c),a.$("calendar-cells").appendChild(b)}var c=a.$("calendar-year").innerHTML,d=a.$("calendar-month").innerHTML;console.log(c,d);var e=new Date(c,d-1,1),f=new Date(c,d,0),g=this.getYMD(e),h=this.getYMD(f);h.day;a.$("tableBody")&&a.$("calendar-cells").removeChild(a.$("tableBody")),b()},selectBoxDisplay:function(a){"block"===a.style.display?a.style.display="none":a.style.display="block"},selectYear:function(b){window.addEventListener("click",function(c){var d=/click-year-box/gi;if((c.target||c.srcElement)&&d.test(c.target.className.toLowerCase())){var e=a.$("calendar1").getElementsByClassName("calendar-year-select")[0];b.selectBoxDisplay(e)}},!1),a.$("calendar-year-select-ul").addEventListener("click",function(a){if((a.target||a.srcElement)&&"li"===a.target.nodeName.toLowerCase()){b.setCldYear(a.target.innerHTML);var c=a.target.parentNode.parentNode;b.selectBoxDisplay(c)}},!1)},selectMonth:function(b){window.addEventListener("click",function(c){var d=/click-month-box/gi;if((c.target||c.srcElement)&&d.test(c.target.className.toLowerCase())){var e=a.$("calendar1").getElementsByClassName("calendar-month-select")[0];b.selectBoxDisplay(e)}},!1),window.addEventListener("click",function(c){if((c.target||c.srcElement)&&"change-btn"===c.target.className.toLowerCase()){var d,e=document.getElementsByClassName("change-btn");e[0]===c.target?(d=a.$("calendar-month").innerHTML,console.log("heihei",d),b.setCldMonth(parseInt(d)-2)):(d=a.$("calendar-month").innerHTML,b.setCldMonth(parseInt(d)))}},!1),a.$("calendar-month-select-ul").addEventListener("click",function(a){if((a.target||a.srcElement)&&"li"===a.target.nodeName.toLowerCase()){var c=a.target.innerHTML;b.setCldMonth(parseInt(c)-1);var d=a.target.parentNode.parentNode;b.selectBoxDisplay(d)}},!1)},selectDay:function(a){window.addEventListener("click",function(b){if((b.target||b.srcElement)&&"td"===b.target.nodeName.toLowerCase()){var c=document.getElementsByTagName("td");if(""!==b.target.innerHTML){for(var d=0;d<c.length;d++)c[d].style.backgroundColor="";b.target.style.backgroundColor="lightgreen",a.setText(b.target.innerHTML)}}},!1),window.addEventListener("mouseover",function(a){(a.target||a.srcElement)&&"td"===a.target.nodeName.toLowerCase()&&""===a.target.innerHTML&&(a.target.style.backgroundColor="#fff")},!1)},showCld:function(){window.addEventListener("click",function(b){(b.target||b.srcElement)&&"input"===b.target.nodeName.toLowerCase()&&("none"===a.$$("calendar")[0].style.display?a.$$("calendar")[0].style.display="block":a.$$("calendar")[0].style.display="none")},!1)}};var F=[];q.prototype={init:function(a){this.li=this.renderTaskList(a)},renderTaskList:function(b){var c=document.createElement("li"),d=document.createElement("div"),e=document.createElement("div"),f=document.createElement("span"),g=document.createElement("i"),h=document.createElement("div"),i=document.createElement("i"),j=document.createElement("span");return c.setAttribute("class","task-list"),c.setAttribute("draggable","true"),d.setAttribute("class","task-list-dragsign"),e.setAttribute("class","task-list-notdone"),f.setAttribute("class","task-list-title"),h.setAttribute("class","task-list-write"),"normal"===b.type?(g.setAttribute("class","fa fa-chevron-right"),g.setAttribute("aria-hidden","true"),i.setAttribute("class","fa fa-pencil-square-o fa-lg"),j.setAttribute("class","task-list-endtime"),j.innerHTML=b.endTime):i.setAttribute("class","fa fa-pencil-square-o fa-lg fast-change-list"),i.setAttribute("aria-hidden","true"),f.innerHTML=b.title,f.appendChild(g),h.appendChild(i),c.appendChild(d),c.appendChild(e),c.appendChild(f),c.appendChild(j),c.appendChild(h),"normal"===b.type?a.$("task-ul-one").appendChild(c):a.$("task-ul-fast").appendChild(c),c}};var G,q=function(b){return console.log("run Tasklist"),b.taskDoneHandle=function(a){console.log("taskDoneHandle"),"task-list-notdone"===a.target.className&&(a.target.className="task-list-done",a.target.parentNode.className="task-list task-list-del",setTimeout(function(){a.target.parentNode.parentNode.removeChild(a.target.parentNode);for(var b=0;b<F.length;b++)if(a.target.parentNode===F[b].li){F[b].pnode.removeChild(F[b].cnode);var c=F[b].pnode.getElementsByClassName("tree-title")[0].innerHTML;F[b].pnode.getElementsByClassName("tree-title")[0].innerHTML=m(c,"sub"),F.splice(b,1),J.TaskChange()}},800))},b.taskMoreHandle=function(b){if("task-list-title"===b.target.className){console.log("lalalala");for(var c=0;c<F.length;c++)b.target.parentNode===F[c].li&&(console.log(F[c].endTime),a.$("popup-task-more").getElementsByTagName("h1")[0].innerHTML=F[c].title,a.$("popup-task-more").getElementsByTagName("section")[0].innerHTML="<p>"+F[c].content+"</p>",r(F[c].endTime))}},b}(q);s.prototype={init:function(){a.$.delegate(a.$$("right-section")[0],"ul","dragover",this.draginHandle),a.$.delegate(a.$$("right-section")[0],"li","dragover",this.draginHandle),a.$.delegate(a.$$("right-section")[0],"li","dragstart",this.dragstartHandle),a.$.delegate(a.$$("right-section")[0],"li","drag",this.dragHandle),a.$.delegate(a.$$("right-section")[0],"li","dragend",this.dragendHandle),a.$.delegate(a.$$("right-section")[0],"li","dragenter",this.dragenterHandle),a.$.delegate(a.$$("right-section")[0],"li","dragleave",this.dragleaveHandle),a.$.delegate(document,"ul","drop",this.dropHandle),a.$.delegate(document,"li","drop",this.dropHandle)},draginHandle:function(a){var b=/task-ul|task-list/gi;b.test(a.target.className.toLowerCase())&&a.preventDefault()},draggableHandle:function(a){var b=/task-list/gi;b.test(a.target.className.toLowerCase())&&(a.target.draggable=!0)},dragstartHandle:function(a){var b=/task-list/gi;(a.target||a.srcElement)&&b.test(a.target.className.toLowerCase())&&(console.log("dragstart"),console.log("dragstart:",a.clientX,a.clientY),dragged=a.target,a.target.style.opacity="1")},dragHandle:function(a){var b=/task-list/gi;(a.target||a.srcElement)&&b.test(a.target.className.toLowerCase())&&(console.log("drag"),a.target.className="dragging-section")},dragendHandle:function(a){console.log("dragend"),console.log("dragend:",a.clientX,a.clientY),a.target.style.opacity="",a.target.className="task-list"},dragenterHandle:function(a){console.log("dragenter");var b=/task-ul/gi;b.test(a.target.className.toLowerCase())&&(a.target.style.background="#222")},dragleaveHandle:function(a){console.log("dragleave");var b=/task-ul/gi;b.test(a.target.className.toLowerCase())&&(a.target.style.background="")},dropHandle:function(a){console.log("drop "+a.target.className+" is preventDefault！");var b=a.target,c=/task-list/gi;c.test(a.target.className.toLowerCase())&&(console.log("apreOrder"),b=a.target.parentNode),console.log(a.clientX,a.clientY,a.target.offsetLeft,a.target.offsetHeight,a.target.offsetTop,a.target.offsetParent,b.offsetTop);var d=a.clientY-b.offsetTop,e=Math.floor(d/45),f=b.getElementsByClassName("task-list");e>f.length+1&&(e=f.length),b.style.background="",dragged.parentNode.removeChild(dragged),b.insertBefore(dragged,f[e])}};var H,I={addnoteText:function(b,c,d){var e=a.$(b);e.innerHTML=c,e.style.color=d},noteText:function(b,c,d){var e=a.$(b);console.log(e),e.style.display="inline-block",e.innerHTML=c,e.style.color=d,H&&(window.clearTimeout(H),console.log("clean")),H=window.setTimeout(function(){console.log(b);var c=a.$(b);c.style.display="none"},2e3),console.log("delay")},trim:function(a){console.log(a);var b=/^\s+|\s+_.$/g;return a.value.replace(b,"")},checkInputText:function(a,b){var c=this.trim(b);return null!==c&&""!==c||this.noteText(a,"查询不能为空","#EC9B69"),c},addcheckInputText:function(a,b){var c=this.trim(b);return null===c||""===c?this.addnoteText(a,"输入任务标题不能为空","#EC9B69"):this.addnoteText(a,"","#376337"),c}},J=function(a){return a.TaskChange=function(){K.list=[];for(var a=0;a<F.length;a++)K.list.push(F[a]);localStorage.setItem("allTasks",JSON.stringify(K))},a.treeNodeIdChange=function(a){L.list=[];for(var c=0;c<b.fatherIdArr.length;c++)L.list.push(b.fatherIdArr[c]);localStorage.setItem("treeClassify",JSON.stringify(L)),localStorage.setItem("d.fatherIdjsq",b.fatherIdjsq)},a.addClassifySto=function(a,c){function d(g){for(var h in g){if(f===b.fatherIdArr.indexOf(a.id)){b.fatherIdArr.push("fatherId"+b.fatherIdjsq),g[h][c]={},e(g[h]);break}f++,"object"==typeof g[h]&&d(g[h])}}function e(a){for(var b in a)f++,"object"==typeof a[b]&&e(a[b])}console.log("addClassifySto");var f=0;return d(b.treedata),localStorage.setItem("treeframe",JSON.stringify(b.treedata)),f},a.delClassifySto=function(a){function c(e){for(var f in e){if(d===b.fatherIdArr.indexOf(a.id)){delete e[f];var g=L.list.indexOf(a.id);L.list.splice(g,1),b.fatherIdArr.splice(d,1);break}d++,"object"==typeof e[f]&&c(e[f])}}console.log("delClassifySto");var d=0;return c(b.treedata),localStorage.setItem("treeframe",JSON.stringify(b.treedata)),d},a}(J||{}),K={list:[]},L={list:[]},M=function(){function a(){var a=JSON.parse(localStorage.getItem("treeframe"));if(console.log("=========================================storage==========================================================="),console.log(a),treedata=a,localStorage.getItem("treeClassify")){var c=JSON.parse(localStorage.getItem("treeClassify"));console.log(c.list),b.fatherIdArr=c.list}b.fatherIdjsq=localStorage.getItem("d.fatherIdjsq"),d()}localStorage.getItem("treeframe")?a():(console.log("!!!!!localStorage.getItem('treeframe')"),d())},N=function(){function d(){var a=JSON.parse(localStorage.getItem("treeClassify"));console.log("========================================= storage treeClassify ======================================================"),console.log(a.list),b.fatherIdArr=a.list}function e(){function b(a){if(a.data!==x){if(null!==a)for(var c=0;c<a.childNode.length;c++)b(a.childNode[c])}else{a.childNode.push(i),i.FatherNode=a,a.data.firstChild.style.display="inline-block",a.data.firstChild.className="fa fa-folder-open-o tree-title-sign",i.data=e,console.log(a.data.id);var d=a.data.getElementsByClassName("tree-title")[0].innerHTML;
a.data.getElementsByClassName("tree-title")[0].innerHTML=m(d,"add");for(var f=0;f<a.childNode.length;f++)a.childNode[f].data.style.display="block"}}var d=JSON.parse(localStorage.getItem("allTasks"));for(console.log("========================================= storage Tasklist ==================================================="),console.log(d);a.$("task-ul-fast").getElementsByTagName("li").length;)a.$("task-ul-fast").removeChild(nowTasklist[0]);for(;a.$("task-ul-one").getElementsByTagName("li").length;)a.$("task-ul-one").removeChild(nowTasklist[0]);for(var e,f=0;f<d.list.length;f++){if(console.log(d.list[f]),"fast"===d.list[f].type){e=g(d.list[f].title,0),a.$(d.list[f].fatherId).appendChild(e),d.list[f].pnode=a.$(d.list[f].fatherId),d.list[f].cnode=e;var h=a.$("fast-task-list").getElementsByClassName("tree-title")[0].innerHTML;a.$("fast-task-list").getElementsByClassName("tree-title")[0].innerHTML=m(h,"add")}else{var i=new c(null,d.list[f].title,0,null,null);e=g(d.list[f].title,0),a.$(d.list[f].fatherId).appendChild(e),d.list[f].pnode=a.$(d.list[f].fatherId),d.list[f].cnode=e,x=a.$(d.list[f].fatherId),b(v)}var j=new q(d.list[f]);j.init(j),F.push(j)}}localStorage.getItem("treeClassify")&&d(),localStorage.getItem("allTasks")?(console.log(" localStorage.getItem('allTasks')"),e()):(console.log("!!!!!localStorage.getItem('allTasks')"),t()),localStorage.getItem("color")&&(document.getElementsByTagName("body")[0].className=localStorage.getItem("color")),localStorage.getItem("font")&&(document.getElementsByTagName("html")[0].className=localStorage.getItem("font"))};return{initAll:u}});